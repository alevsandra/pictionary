from django.test import TestCase
from .models import Drawing
import base64
import pickle
import matplotlib.pyplot as plt


class DBIntegrationTest(TestCase):
    # MY_CATEGORIES = ['warkocz', 'flet', 'Ziemia', 'góry', 'spódnica',
    #                  'sukienka', 'ogon', 'macka', 'kod kreskowy', 'koza']
    QUICK_DRAW_IMAGE = b'gASVnwMAAAAAAACMFW51bXB5LmNvcmUubXVsdGlhcnJheZSMDF9yZWNvbnN0cnVjdJSTlIwFbnVtcHmUjAduZGFycmF5lJOUSwCFlEMBYpSHlFKUKEsBSxxLHEsBh5RoA4wFZHR5cGWUk5SMAnUxlImIh5RSlChLA4wBfJROTk5K/////0r/////SwB0lGKJQhADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABT+P1lAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMvz/uCESDAAAAAAAAAAAAAAAAAAAAAAAAAAAAABq/8D///5KAAAAAAAAAAAAAAAAAAAAAAAAAAAAZf/2/Of/UAAAAAAAAAAAAAAAAAAAAAAAAA5yiL791uDl/7GIiIiIiIiIiIiAcGFSQzACAABd//Pv8u7u8Pfu7u7u7u7u7u7u+f//////XgAAFvt9AAAAAAAAAAAAAAAAAAAAAAAJGCdU/1cAAAC1+L+fRDMzIiIXEQsAAAAAAAAABhgra/89AAAAIIXQ///////////////u7uPh8//////pFQAAAAAADq7X4+z0/////7x9iImZl4VzYU86BgAAAAAAAAAAAAAAAAAMFyIEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlHSUYi4='
    MY_IMAGE = b'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XwAAAIQAAABBAAAAAAAAAAAAAAAeAAAAdwAAADcAAABfAAAAVAAAACMAAAAQAAAAZAAAAIIAAABAAAAAFwAAAC0AAABqAAAAkQAAADUAAAA2AAAAhAAAAF8AAABdAAAAfgAAAG0AAAAdAAAAAAAAAAAAAAAYAAAAZgAAAIMAAABVAAAALgAAAKQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXAAAAYgAAAHIAAABnAAAAOQAAAAAAAAAAAAAAAAAAAAoAAAA2AAAANwAAAA8AAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAASAAAASQAAAGQAAABXAAAAAgAAAAMAAAADAAAAAQAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAgAAAAMAAAACAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlHSUYi4='

    def setUp(self):
        Drawing.objects.create(category='lotniskowiec', picture=self.QUICK_DRAW_IMAGE)
        Drawing.objects.create(category='macka', picture=self.MY_IMAGE)

    def test_bytes_decode(self):
        for drawing in Drawing.objects.all():
            np_bytes = base64.b64decode(drawing.picture)
            # if drawing.category not in self.MY_CATEGORIES:
            np_array = pickle.loads(np_bytes)
            self.assertEqual(np_array.shape[0], 28)
            self.assertEqual(np_array.shape[1], 28)
            # else:
            #     i = io.BytesIO(np_bytes)
            #     np_array = mpimg.imread(i, format='JPG')
            self.assertEqual(len(np_array.shape), 3)
            plt.imshow(np_array, cmap='gray')
            plt.show()
